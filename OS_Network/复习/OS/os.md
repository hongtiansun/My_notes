# OS笔记

## 第一章 操作系统基本概念

### 1.1 OS的概念和功能

#### 1.1.1 概念

**计算机系统的层次结构**：

![](images/APi-2025-03-08-10-47-17.png)

**OS的基本定义**：

控制和管理整个计算机系统的硬件和软件资源，并合理组织分配计算机工作和资源的分配，提供给用户和其他软件方便的接口和环境 (操作系统是最基本的系统软件)

功能：
- 操作系统是系统资源的管理者
- 向上层提供方便易用的服务
- 最接近硬件的软件

#### 1.1.2 功能

**OS的基本功能**：

作为系统管理者：

- 文件管理
- 存储器管理(内存控制)
- 处理机管理(进程管理)
- 设备管理

目标为了实现安全和高效

 ---

为上层提供服务：

封装思想：将硬件的二进制接口封装成简单易用的服务，提供给上层应用程序调用

服务如下：
- GUI图像化用户接口(普通用户)
- 命令式接口服务(普通用户)
  - 联机命令接口(交互式) cmd命令
  - 脱机命令接口(批处理) bat批处理
- 程序接口(程序员软件配置)
  - 程序中使用系统调用使用程序接口

系统调用也被称为广义指令，他是程序调用系统资源的唯一方式。

程序接口和命令接口也被称之为用户接口

 ---

最接近硬件的层次：

实现了对硬件机器的扩展功能

没有任何软件支持的计算机被称为逻机
覆盖了软件的机器被称为扩充机器或者虚拟机

### 1.2 操作系统的特征

#### 1.2.1 并发

**概念**

两个或多个事件在同一时间间隔内发生
- 宏观 同时发生
- 微观 交替发生

区分并发和并行：
两个或者多个事件在同一时刻一起发生才叫并行

**操作系统并发性**

操作系统中，同时运行着多个程序宏观上同时 微观上交替
操作系统伴随着多道程序技术出现，因而操作系统与并发是一起诞生的

并发性是操作系统最基本的特征。

**cpu影响**

- 单核cpu 同一时刻只能执行一个程序，多程序 并发
- 多核cpu 同一时刻可以同时执行多个程序，多程序可以并行

#### 1.2.2 共享

**概念**

资源共享：系统中的资源可以供给内存中多个并发执行的进程共同使用

**基本方式**

互斥共享方式：一个时间段内只允许一个进程访问该资源

同时共享方式：允许一个时间段内，多个进程同时对它进行访问

注意：同时表示宏观上的同时，微观上可能是交替对该资源进行访问(微观不确定哦)

并发与共享的关系：
并发性指计算机系统可以同时运行多个程序
共享性指系统中的资源可以供给多个并发的进程共同使用
并发共享互为存在条件

#### 1.2.3 虚拟

把**一个物理上的实体变为若干个逻辑上的对应物**
物理实体是实际存在的
逻辑对应物用户感受到的

虚拟技术：
时分复用技术：虚拟处理器技术(时分复用技术)
空分复用技术：虚拟存储器技术(空分复用技术)
		
没用并发性就谈不上虚拟性

#### 1.2.4 异步

多道程序环境下，允许多个程序并发执行
由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度前进(异步性)

只有系统拥有并发性，才有可能导致异步性

总结
- 并发与共享互为存在条件
- 没有并发与共享，就谈不上虚拟和异步，因而并发与共享是操作系统的最基本特征
- 并发和共享是操作系统的最基本特征

### 1.3 操作系统的发展与分类

#### 1.3.1 手工操作阶段

打孔编程，放入纸带机，计算机计算，打孔机打孔，程序员分析

![](images/APi-2025-03-12-17-02-33.png)

缺点：
- 用户独占全机
- 人机速度矛盾导致资源利用率极低

#### 1.3.2 批处理阶段

单道批处理系统：

引入脱机输入输出技术(外围机+磁带)，由监督程序负责控制作业的输入输出
![](images/APi-2025-03-12-17-03-40.png)

磁带到计算机到磁带：读入读出，速度更快
![](images/APi-2025-03-12-17-04-42.png)

优点：缓解了人机速度矛盾 资源利用率有所提升
缺点：
- 内存中仅有一道程序运行
- CPU有大量空闲时间等待IO
- 资源利用率低

---

多道批处理系统:

操作系统正式诞生，支持多道程序并发运行
读入时，每次往内存中读入多道程序
![](images/APi-2025-03-12-17-06-37.png)

优点:
- 多道程序并发执行，共享计算机资源
- 资源利用率大幅提升
- CPU和其他资源保持忙绿状态，系统吞吐量增大
缺点:
- 没有人机交互功能
- 无法调试程序

#### 1.3.3 分时操作系统

计算机以时间片为单位轮流为各个用户/作业服务，各个用户可以通过终端与计算机进行交互

优点：解决人机交互问题
缺点：不能优先处理紧急任务

![](images/APi-2025-03-12-17-08-25.png)

#### 1.3.4 实时操作系统

优先响应一些紧急任务。某些任务，不需要时间片排队
保证在严格的时限内处理完时间，保证及时性和可靠性

分类：
- 硬实时系统：严格在规定时间内完成处理，如导弹控制，自动驾驶
- 软实时系统：能接受偶尔违反时间规定，如12306火车订票


#### 1.3.5 网络操作系统

实现网络中各种资源的共享(文件共享)和各台计算机之间的通信
如Windows NT

#### 1.3.6 分布式操作系统

- 分布性
- 并行性

系统中各台计算机地位相同，任何工作都可以分布在这些计算机上，由他们并行协同完成任务

#### 1.3.7 个人操作系统

Windows 7 Macos

### 1.4 运行机制

#### 1.4.1 预备知识

程序如何运行？
C语言代码->编译->机器指令(二进制)，一条高级语言代码可能对应多条机器指令

指令，即为CPU能识别，执行的最基本命令（CPU指令集）(计算机组成原理)

#### 1.4.2 两种指令

**特权指令**

内核作为管理者，让CPU执行的特权指令，如内存清零指令
影响重大，可能会影响其他程序
只允许操作系统内核使用

**非特权指令**

应用程序只能使用非特权指令 (如加法指令，减法指令)

注意：
程序的执行：CPU执行一条一条的机器指令的过程
CPU在设计和生产的时候就划分了特权指令和非特权指令，CPU可以区分指令类型(PSW程序状态寄存器)

#### 1.4.3 两种CPU状态

- 用户态(目态)(核心态)
	CPU用户态，运行应用程序只能执行非特权指令
- 内核态(管态)
	CPU内核态，运行的是内核程序可移植性特权指令

判断状态：程序状态寄存器(PSW)
- 1表示内核态
- 0表示用户态

CPU状态切换过程：
- 开机时：CPU为内核态，内核程序先在CPU上运行
- 开机完成，用户启动某个程序
- 内核程序在合适时机让出CPU，应用程序在CPU上运行
	让出CPU之前，内核在让出CPU之前，用特权指令令PSW的标志位设置为用户态
- 应用程序运行在用户态
- CPU发现自己执行的指令为特权指令时，自己又在用户态
- 此非法事件引发一个中断信号(处理中断信号的是内核程序)
	CPU检测到中断信号，立即变为核心态，停止运行当前应用程序，转而运行处理中断信号的内核程序
- CPU在内核态下，执行内核指令
- 中断使操作系统再次夺回CPU控制权
- 操作系统对中断事件处理
  处理完了后再把CPU使用权交给应用程序

总结：
- 内核到用户：执行特权指令 操作系统主动让出CPU使用权修改PSW(特权指令)
- 用户到内核：中断引发 硬件自动完成变态过程
  触发中断信号，意味着操作系统将强夺CPU的使用权(中断,硬件自动完成)
![](images/APi-2025-03-12-17-23-43.png)

#### 1.4.4 两种程序

内核程序：

许多内核程序实现操作系统：
- 许多的内核程序组成了系统内核(Kernel)
- 内核是最接近硬件的部分

一个操作系统只需要内核就可以实现功能(Docker->仅仅需要Linux内核)

注意:操作系统功能不一定全在内核中，如GUI

---

应用程序：

程序员编写

### 1.5 中断
